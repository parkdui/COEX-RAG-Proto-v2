# 📝 API 로깅 가이드

## 환경 변수 설정

### 로컬 개발
`.env.local` 파일에 추가:
```bash
LOG_API_INPUT=1  # API 호출 상세 로그 (메시지 내용 포함)
LOG_TOKENS=1     # 토큰 사용량 로그
```

### Vercel 배포
Vercel 대시보드 → Settings → Environment Variables:
```
LOG_API_INPUT=1
LOG_TOKENS=1
```

## 로그 출력 예시

### 1. API 호출 전 (메시지 내용)
```
================================================================================
📤 [API CALL] CLOVA Chat API 호출
================================================================================

📋 System Prompt 길이: 1300자 (약 1820 tokens)
📋 History 메시지 수: 2개
  [1] user: 질문: 안녕하세요... (50자)
  [2] assistant: 안녕하세요! 코엑스에 오신 것을 환영합니다... (80자)
📋 User Message: 질문: 추천해줘

[참고 이벤트]
[1] 전시회 | 2025-01-15 | 코엑스 A홀 | IT/기술
전시회 내용...

위 정보로 답하세요. 30자 이내. (200자)
📋 총 메시지 수: 4개
📋 총 문자 수: 1630자 (약 2282 tokens 예상)
================================================================================
```

### 2. API 응답 후 (실제 토큰 사용량)
```
================================================================================
📥 [API RESPONSE] CLOVA Chat API 응답
================================================================================
💬 [CHAT] input=2300 output=45 total=2345
💬 [CHAT] 누적: input=2300 output=45 total=2345 (calls=1)
📝 [RESPONSE] 안녕하세요! 코엑스에 오신 것을 환영합니다...
================================================================================
```

### 3. 토큰 요약 (요청 종료 시)
```
================================================================================
📊 [TOKEN SUMMARY] 이번 요청 토큰 사용량
================================================================================
🔍 Classification: 50 tokens (1 calls)
📦 Embedding: 120 tokens (1 calls)
💬 Chat: 2345 tokens (1 calls)
📊 총합: 2515 tokens
================================================================================
```

## 로그 확인 방법

### 로컬 개발
터미널에서 직접 확인:
```bash
npm run dev
# API 호출 시 터미널에 로그 출력
```

### Vercel 배포
1. Vercel 대시보드 접속
2. 프로젝트 선택
3. Deployments → Functions → Logs 클릭
4. 실시간 로그 확인

## 로그 레벨

### LOG_API_INPUT=1
- API 호출 전 메시지 내용 전체 출력
- API 응답 후 실제 토큰 사용량 출력
- 토큰 요약 출력

### LOG_TOKENS=1
- 토큰 사용량만 간단히 출력
- 기존 로그 유지

### 둘 다 설정
- 모든 로그 출력 (가장 상세함)

## 주의사항

⚠️ **프로덕션 환경에서는 주의하세요**
- 로그가 매우 많아질 수 있습니다
- 필요시에만 활성화하세요
- 민감한 정보가 로그에 포함될 수 있습니다

## 로그 비활성화

환경 변수를 제거하거나 `0`으로 설정:
```bash
LOG_API_INPUT=0
LOG_TOKENS=0
```





