# í† í° ì‚¬ìš©ëŸ‰ ê³„ì‚°: 6ë²ˆ ëŒ€í™” (ì •ë³´ì„± 3ë²ˆ + ë¹„ì •ë³´ì„± 3ë²ˆ)

## ğŸ“Š ê³„ì‚° ê¸°ì¤€

### 1. Classification API (ëª¨ë“  ì§ˆë¬¸ë§ˆë‹¤ í˜¸ì¶œ)
- **System prompt**: ~50 tokens
- **User prompt**: ~200 tokens (ì§ˆë¬¸ ì˜ˆì‹œ í¬í•¨)
- **Output**: ~5 tokens (YES/NO)
- **ì´ 1íšŒë‹¹**: ~255 tokens
- **6íšŒ ì´í•©**: ~1,530 tokens

### 2. Embedding API (ì •ë³´ì„± ì§ˆë¬¸ë§Œ)
- **Input**: ì§ˆë¬¸ í…ìŠ¤íŠ¸ (í‰ê·  ~30 tokens)
- **Output**: ì—†ìŒ (ë²¡í„°ë§Œ ë°˜í™˜)
- **ì´ 1íšŒë‹¹**: ~30 tokens
- **3íšŒ ì´í•©**: ~90 tokens

### 3. Chat API (ëª¨ë“  ì§ˆë¬¸ë§ˆë‹¤ í˜¸ì¶œ)

#### System Prompt êµ¬ì„±
- ê¸°ë³¸ system_prompt.txt: 6,424 bytes â‰ˆ **~3,500 tokens** (í•œê¸€ ê¸°ì¤€)
- ë‚ ì§œ ì •ë³´ ì¶”ê°€: ~50 tokens
- ì‘ë‹µ í˜•ì‹ ê·œì¹™: ~30 tokens
- **ì´ System Prompt**: ~3,580 tokens

#### ì •ë³´ì„± ì§ˆë¬¸ (3ë²ˆ)

**1ë²ˆì§¸ ì§ˆë¬¸ (ì •ë³´ì„±):**
- System: ~3,580 tokens
- History: ì—†ìŒ
- User message: ì§ˆë¬¸(~30) + RAG context(~800) = ~830 tokens
- Output: ~150 tokens (200ì ì´ë‚´)
- **ì´**: ~4,560 tokens
- **Historyì— ì¶”ê°€ë  ë‚´ìš©**: user(~830) + assistant(~150) = ~980 tokens

**2ë²ˆì§¸ ì§ˆë¬¸ (ì •ë³´ì„±):**
- System: ~3,580 tokens
- History: ì´ì „ 1í„´ (~980 tokens)
- User message: ì§ˆë¬¸(~30) + RAG context(~800) = ~830 tokens
- Output: ~150 tokens
- **ì´**: ~5,540 tokens
- **Historyì— ì¶”ê°€ë  ë‚´ìš©**: user(~830) + assistant(~150) = ~980 tokens

**3ë²ˆì§¸ ì§ˆë¬¸ (ì •ë³´ì„±):**
- System: ~3,580 tokens
- History: ì´ì „ 2í„´ (~980 + ~980 = ~1,960 tokens)
- User message: ì§ˆë¬¸(~30) + RAG context(~800) = ~830 tokens
- Output: ~150 tokens
- **ì´**: ~6,520 tokens
- **Historyì— ì¶”ê°€ë  ë‚´ìš©**: user(~830) + assistant(~150) = ~980 tokens

**ì •ë³´ì„± ì§ˆë¬¸ Chat API ì´í•©**: ~16,620 tokens

#### ë¹„ì •ë³´ì„± ì§ˆë¬¸ (3ë²ˆ)

**4ë²ˆì§¸ ì§ˆë¬¸ (ë¹„ì •ë³´ì„±):**
- System: ~3,580 tokens
- History: ì´ì „ 3í„´ (~980 + ~980 + ~980 = ~2,940 tokens)
- User message: ì§ˆë¬¸ë§Œ (~30 tokens)
- Output: ~100 tokens (ì§§ì€ ë‹µë³€)
- **ì´**: ~6,650 tokens
- **Historyì— ì¶”ê°€ë  ë‚´ìš©**: user(~30) + assistant(~100) = ~130 tokens

**5ë²ˆì§¸ ì§ˆë¬¸ (ë¹„ì •ë³´ì„±):**
- System: ~3,580 tokens
- History: ì´ì „ 4í„´ (~2,940 + ~130 = ~3,070 tokens)
- User message: ì§ˆë¬¸ë§Œ (~30 tokens)
- Output: ~100 tokens
- **ì´**: ~6,780 tokens
- **Historyì— ì¶”ê°€ë  ë‚´ìš©**: user(~30) + assistant(~100) = ~130 tokens

**6ë²ˆì§¸ ì§ˆë¬¸ (ë¹„ì •ë³´ì„±):**
- System: ~3,580 tokens
- History: ì´ì „ 5í„´ (~3,070 + ~130 = ~3,200 tokens)
- User message: ì§ˆë¬¸ë§Œ (~30 tokens)
- Output: ~100 tokens
- **ì´**: ~6,910 tokens
- **Historyì— ì¶”ê°€ë  ë‚´ìš©**: user(~30) + assistant(~100) = ~130 tokens

**ë¹„ì •ë³´ì„± ì§ˆë¬¸ Chat API ì´í•©**: ~20,340 tokens

---

## ğŸ§® ìµœì¢… ê³„ì‚°

### ì„¸ë¶€ ë‚´ì—­

| í•­ëª© | 1íšŒë‹¹ | íšŸìˆ˜ | ì´í•© |
|------|-------|------|------|
| **Classification API** | 255 | 6 | **1,530** |
| **Embedding API** | 30 | 3 | **90** |
| **Chat API (ì •ë³´ì„±)** | - | 3 | **16,620** |
| **Chat API (ë¹„ì •ë³´ì„±)** | - | 3 | **20,340** |
| **í•©ê³„** | - | - | **38,580 tokens** |

### ğŸ“ˆ ëˆ„ì  í† í° ì‚¬ìš©ëŸ‰

| ì§ˆë¬¸ ë²ˆí˜¸ | ìœ í˜• | Classification | Embedding | Chat | ëˆ„ì  ì´í•© |
|-----------|------|----------------|-----------|------|-----------|
| 1 | ì •ë³´ì„± | 255 | 30 | 4,560 | **4,845** |
| 2 | ì •ë³´ì„± | 255 | 30 | 5,540 | **10,670** |
| 3 | ì •ë³´ì„± | 255 | 30 | 6,520 | **17,475** |
| 4 | ë¹„ì •ë³´ì„± | 255 | 0 | 6,650 | **24,380** |
| 5 | ë¹„ì •ë³´ì„± | 255 | 0 | 6,780 | **31,415** |
| 6 | ë¹„ì •ë³´ì„± | 255 | 0 | 6,910 | **38,580** |

---

## ğŸ’¡ ì£¼ìš” ì¸ì‚¬ì´íŠ¸

### 1. Chat APIê°€ ëŒ€ë¶€ë¶„ ì°¨ì§€
- **38,580 tokens ì¤‘ 36,960 tokens (95.8%)**ê°€ Chat API
- System Promptê°€ ê°€ì¥ í° ë¹„ì¤‘ (~3,580 tokens Ã— 6 = 21,480 tokens)

### 2. System Promptì˜ ì˜í–¥
- System Prompt: ~3,580 tokens (ë§¤ ì§ˆë¬¸ë§ˆë‹¤ í¬í•¨)
- 6ë²ˆ ì§ˆë¬¸ Ã— 3,580 = 21,480 tokens (ì „ì²´ì˜ 55.7%)
- System Prompt ìµœì í™”ê°€ ê°€ì¥ íš¨ê³¼ì 

### 3. History ëˆ„ì  íš¨ê³¼
- 1ë²ˆì§¸ ì§ˆë¬¸: ~4,560 tokens
- 6ë²ˆì§¸ ì§ˆë¬¸: ~6,910 tokens (ì•½ 1.5ë°° ì¦ê°€)
- Historyê°€ ëˆ„ì ë˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ ì¦ê°€

### 4. ì •ë³´ì„± vs ë¹„ì •ë³´ì„±
- ì •ë³´ì„± ì§ˆë¬¸: í‰ê·  ~5,540 tokens/ì§ˆë¬¸
- ë¹„ì •ë³´ì„± ì§ˆë¬¸: í‰ê·  ~6,780 tokens/ì§ˆë¬¸
- **ë¹„ì •ë³´ì„± ì§ˆë¬¸ì´ ë” ë§ì€ í† í° ì‚¬ìš©** (ì´ì „ ì •ë³´ì„± ì§ˆë¬¸ì˜ ê¸´ History ë•Œë¬¸)

---

## ğŸ¯ ìµœì í™” ë°©ì•ˆ

### 1. History ì œí•œ
```typescript
// ìµœê·¼ Ní„´ë§Œ í¬í•¨
const historyToSend = history.slice(-3); // ìµœê·¼ 3í„´ë§Œ
```

**íš¨ê³¼**: 6ë²ˆì§¸ ì§ˆë¬¸ ì‹œ ~46,520 â†’ ~15,000 tokens (ì•½ 68% ê°ì†Œ)

### 2. System Prompt ìµœì í™”
- ë¶ˆí•„ìš”í•œ ë¶€ë¶„ ì œê±°
- ë” ê°„ê²°í•˜ê²Œ ì‘ì„±

**íš¨ê³¼**: ~580 â†’ ~400 tokens (ì•½ 31% ê°ì†Œ)

### 3. RAG Context ì••ì¶•
- TOP_Kë¥¼ 3ì—ì„œ 2ë¡œ ê°ì†Œ
- Context í…ìŠ¤íŠ¸ ìš”ì•½

**íš¨ê³¼**: ~800 â†’ ~500 tokens (ì•½ 38% ê°ì†Œ)

---

## ğŸ“Š ì‹¤ì œ ì˜ˆìƒ ë²”ìœ„

### ë³´ìˆ˜ì  ì¶”ì • (ì§§ì€ ëŒ€í™”)
- Classification: 1,530 tokens
- Embedding: 90 tokens
- Chat: 32,000 tokens
- **ì´í•©: ~33,620 tokens**

### í‰ê·  ì¶”ì • (í˜„ì¬ ê³„ì‚°)
- **ì´í•©: ~38,580 tokens**

### ë‚™ê´€ì  ì¶”ì • (ê¸´ ëŒ€í™”)
- Classification: 1,530 tokens
- Embedding: 90 tokens
- Chat: 45,000 tokens
- **ì´í•©: ~46,620 tokens**

---

## ğŸ’° ë¹„ìš© ì¶”ì • (ì°¸ê³ )

CLOVA API ê°€ê²© ê¸°ì¤€ (ì˜ˆìƒ):
- Input: $0.001 per 1K tokens
- Output: $0.002 per 1K tokens

**38,580 tokens ì„¸ì…˜ë‹¹ ë¹„ìš©**:
- Input: ~$0.033
- Output: ~$0.013
- **ì´: ~$0.046 per session (ì•½ $0.05)**

---

## âœ… ê²°ë¡ 

**6ë²ˆ ëŒ€í™” (ì •ë³´ì„± 3ë²ˆ + ë¹„ì •ë³´ì„± 3ë²ˆ) í‰ê·  í† í° ì‚¬ìš©ëŸ‰:**

### ğŸ¯ **ì•½ 39,000 tokens**

**ë²”ìœ„**: 34,000 ~ 47,000 tokens

**ì£¼ìš” ìš”ì¸**:
1. **System Prompt** (ê°€ì¥ í° ìš”ì¸, ~3,580 tokens Ã— 6 = 21,480 tokens, ì „ì²´ì˜ 55.7%)
2. **History ëˆ„ì ** (ì´ì „ ëŒ€í™” í¬í•¨, ~3,200 tokens, ì „ì²´ì˜ 8.3%)
3. **RAG Context** (ì •ë³´ì„± ì§ˆë¬¸, ~800 tokens Ã— 3 = 2,400 tokens, ì „ì²´ì˜ 6.2%)

**ìµœì í™” ì‹œ**: 
- System Prompt ìµœì í™”: ~25,000 tokensê¹Œì§€ ê°ì†Œ ê°€ëŠ¥
- History ì œí•œ ì¶”ê°€: ~30,000 tokensê¹Œì§€ ê°ì†Œ ê°€ëŠ¥
- ë‘˜ ë‹¤ ì ìš©: ~20,000 tokensê¹Œì§€ ê°ì†Œ ê°€ëŠ¥

